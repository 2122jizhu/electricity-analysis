<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ç”µåŠ›å‡€è¿›å£/å‡ºå£å›½æ’è¡Œæ¦œ</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: #f5f7fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .chart-container { background: white; border-radius: 10px; padding: 20px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h2 { color: #333; border-left: 4px solid #5470c6; padding-left: 10px; }
        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { flex: 1; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .stat-card h3 { margin: 0 0 10px 0; color: #666; font-size: 14px; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .import { color: #ee6666; }
        .export { color: #73c0de; }
    </style>
</head>
<body>
<div class="container">
    <h1>ğŸŒ å›½å®¶ç”µåŠ›è‡ªç»™ç‡åˆ†æ (2021)</h1>
    <p>å‡€è¿›å£é‡ä¸ºæ­£è¡¨ç¤ºä¾èµ–è¿›å£ï¼Œä¸ºè´Ÿè¡¨ç¤ºç”µåŠ›å‡€å‡ºå£</p>

    <div class="stats">
        <div class="stat-card">
            <h3>æœ€å¤§ç”µåŠ›è¿›å£å›½</h3>
            <div class="stat-value import">æ„å¤§åˆ©</div>
            <div>42.79 äº¿åƒç“¦æ—¶</div>
        </div>
        <div class="stat-card">
            <h3>æœ€å¤§ç”µåŠ›å‡ºå£å›½</h3>
            <div class="stat-value export">æ³•å›½</div>
            <div>-44.84 äº¿åƒç“¦æ—¶</div>
        </div>
        <div class="stat-card">
            <h3>å‡€å‡ºå£æ€»å€¼</h3>
            <div class="stat-value export">-240.69 äº¿åƒç“¦æ—¶</div>
            <div>å‰10å‡ºå£å›½åˆè®¡</div>
        </div>
    </div>

    <div class="chart-container">
        <h2>ç”µåŠ›å‡€è¿›å£/å‡ºå£ Top 5 å›½å®¶å¯¹æ¯”</h2>
        <div id="chart1" style="width: 100%; height: 500px;"></div>
    </div>

    <div class="chart-container">
        <h2>ç”µåŠ›è´¸æ˜“ç½‘ç»œå…³ç³»å›¾</h2>
        <div id="chart2" style="width: 100%; height: 600px;"></div>
    </div>
</div>

<script>
    // æ‚¨çš„JSONæ•°æ®
    const jsonData = {
        "importers": [
            {"Country":"Italy","Value":42.7941714},
            {"Country":"United States","Value":39.325422},
            {"Country":"Thailand","Value":28.67575368},
            {"Country":"United Kingdom","Value":24.5773724},
            {"Country":"Brazil","Value":23.103},
        ],
        "exporters": [
            {"Country":"France","Value":-44.8369104},
            {"Country":"Canada","Value":-38.073045},
            {"Country":"Laos","Value":-31.15037415},
            {"Country":"Paraguay","Value":-28.005},
            {"Country":"Sweden","Value":-25.568867},
        ]
    };

    // æ•°æ®å¤„ç†
    const importers = jsonData.importers.map(item => ({
        name: item.Country,
        value: item.Value
    }));

    const exporters = jsonData.exporters.map(item => ({
        name: item.Country,
        value: Math.abs(item.Value)  // å–ç»å¯¹å€¼ç”¨äºæ˜¾ç¤º
    }));

    // ä¸ºåŒå‘æ¡å½¢å›¾å‡†å¤‡æ•°æ®
    const allData = [...jsonData.importers, ...jsonData.exporters]
        .sort((a, b) => b.Value - a.Value);  // æŒ‰æ•°å€¼æ’åº

    // å›¾è¡¨1ï¼šåŒå‘æ¡å½¢å›¾
    const chart1 = echarts.init(document.getElementById('chart1'));
    const option1 = {
        tooltip: {
            trigger: 'axis',
            axisPointer: { type: 'shadow' },
            formatter: function(params) {
                const data = params[0];
                const sign = data.value > 0 ? '+' : '';
                return `${data.name}<br/>å‡€è¿›å£é‡: <b>${sign}${data.value.toFixed(2)}</b> äº¿åƒç“¦æ—¶`;
            }
        },
        legend: {
            data: ['å‡€è¿›å£', 'å‡€å‡ºå£'],
            top: 10
        },
        grid: {
            left: '3%',
            right: '4%',
            bottom: '3%',
            containLabel: true
        },
        xAxis: {
            type: 'value',
            name: 'å‡€è¿›å£é‡ (äº¿åƒç“¦æ—¶)',
            axisLabel: {
                formatter: function(value) {
                    return value > 0 ? `+${value}` : value;
                }
            }
        },
        yAxis: {
            type: 'category',
            data: allData.map(item => item.Country),
            axisLabel: {
                formatter: function(name) {
                    // æŸ¥æ‰¾å¯¹åº”çš„å€¼
                    const item = allData.find(d => d.Country === name);
                    const color = item.Value > 0 ? '#ee6666' : '#73c0de';
                    return `{${color}|â—} ${name}`;
                },
                rich: {
                    '#ee6666': { color: '#ee6666' },
                    '#73c0de': { color: '#73c0de' }
                }
            }
        },
        series: [
            {
                name: 'å‡€è¿›å£',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true,
                    position: 'right',
                    formatter: '{c}'
                },
                itemStyle: {
                    color: '#ee6666'
                },
                data: allData.map(item => item.Value > 0 ? item.Value : 0)
            },
            {
                name: 'å‡€å‡ºå£',
                type: 'bar',
                stack: 'total',
                label: {
                    show: true,
                    position: 'left',
                    formatter: function(params) {
                        return Math.abs(params.value).toFixed(2);
                    }
                },
                itemStyle: {
                    color: '#73c0de'
                },
                data: allData.map(item => item.Value < 0 ? item.Value : 0)
            }
        ]
    };

    // å›¾è¡¨2ï¼šæ¡‘åŸºå›¾ï¼ˆç”µåŠ›è´¸æ˜“ç½‘ç»œï¼‰
    const chart2 = echarts.init(document.getElementById('chart2'));

    // åˆ›å»ºè™šæ‹Ÿçš„è´¸æ˜“å…³ç³»ï¼ˆåŸºäºè¿›å‡ºå£é‡ï¼‰
    const tradeRelations = [];
    jsonData.exporters.forEach(exporter => {
        const exportAmount = Math.abs(exporter.Value);
        let distributed = 0;

        // å°†å‡ºå£å›½çš„ç”µåŠ›åˆ†é…ç»™è¿›å£å›½
        jsonData.importers.forEach(importer => {
            if (distributed < exportAmount) {
                const share = Math.min(importer.Value, exportAmount - distributed) * 0.3;
                if (share > 0.1) {
                    tradeRelations.push({
                        source: exporter.Country,
                        target: importer.Country,
                        value: parseFloat(share.toFixed(2))
                    });
                    distributed += share;
                }
            }
        });
    });

    const option2 = {
        title: {
            text: 'ç”µåŠ›è´¸æ˜“ç½‘ç»œæµå‘å›¾',
            subtext: 'æ¨¡æ‹Ÿä¸»è¦ç”µåŠ›å‡ºå£å›½åˆ°è¿›å£å›½çš„è´¸æ˜“å…³ç³»',
            left: 'center'
        },
        tooltip: {
            trigger: 'item',
            formatter: '{b}'
        },
        series: [
            {
                type: 'sankey',
                layout: 'none',
                emphasis: {
                    focus: 'adjacency'
                },
                nodeAlign: 'left',
                data: [
                    ...jsonData.exporters.map(item => ({
                        name: item.Country,
                        itemStyle: { color: '#73c0de' }
                    })),
                    ...jsonData.importers.map(item => ({
                        name: item.Country,
                        itemStyle: { color: '#ee6666' }
                    }))
                ],
                links: tradeRelations,
                lineStyle: {
                    color: 'source',
                    curveness: 0.5
                },
                label: {
                    color: '#333',
                    fontSize: 12
                }
            }
        ]
    };

    chart1.setOption(option1);
    chart2.setOption(option2);

    // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨
    window.addEventListener('resize', function() {
        chart1.resize();
        chart2.resize();
    });
</script>
</body>
</html>
